function Animator(a){this.setOptions(a);var b=this;this.timerDelegate=function(){b.onTimerEvent()},this.subjects=[],this.target=0,this.state=0,this.lastTime=null}function NumericalStyleSubject(a,b,c,d,e){this.els=Animator.makeArrayOfElements(a),this.property=Animator.camelize(b),this.from=parseFloat(c),this.to=parseFloat(d),this.units=null!=e?e:"px"}function ColorStyleSubject(a,b,c,d){this.els=Animator.makeArrayOfElements(a),this.property=Animator.camelize(b),this.to=this.expandColor(d),this.from=this.expandColor(c),this.origFrom=c,this.origTo=d}function DiscreteStyleSubject(a,b,c,d,e){this.els=Animator.makeArrayOfElements(a),this.property=Animator.camelize(b),this.from=c,this.to=d,this.threshold=e||.5}function CSSStyleSubject(a,b,c){if(a=Animator.makeArrayOfElements(a),this.subjects=[],0!=a.length){var d,e,f;if(c)f=this.parseStyle(b,a[0]),e=this.parseStyle(c,a[0]);else{e=this.parseStyle(b,a[0]),f={};for(d in e)f[d]=CSSStyleSubject.getStyle(a[0],d)}var d;for(d in f)f[d]==e[d]&&(delete f[d],delete e[d]);var d,g,h,i,j,k;for(d in f){var l=String(f[d]),m=String(e[d]);if(null!=e[d]){if(j=ColorStyleSubject.parseColor(l))k=ColorStyleSubject.parseColor(m),i=ColorStyleSubject;else if(l.match(CSSStyleSubject.numericalRe)&&m.match(CSSStyleSubject.numericalRe)){j=parseFloat(l),k=parseFloat(m),i=NumericalStyleSubject,h=CSSStyleSubject.numericalRe.exec(l);var n=CSSStyleSubject.numericalRe.exec(m);g=null!=h[1]?h[1]:null!=n[1]?n[1]:n}else{if(!l.match(CSSStyleSubject.discreteRe)||!m.match(CSSStyleSubject.discreteRe)){window.ANIMATOR_DEBUG&&alert("Unrecognised format for value of "+d+": '"+f[d]+"'");continue}j=l,k=m,i=DiscreteStyleSubject,g=0}this.subjects[this.subjects.length]=new i(a,d,j,k,g)}else window.ANIMATOR_DEBUG&&alert("No to style provided for '"+d+'"')}}}function AnimatorChain(a,b){this.animators=a,this.setOptions(b);for(var c=0;c<this.animators.length;c++)this.listenTo(this.animators[c]);this.forwards=!1,this.current=0}!function(){function q(a,b,c,d,e,f){for(var g=0,h=d.length;h>g;g++){var i=d[g];if(i){var j=!1;for(i=i[a];i;){if(i.sizcache===c){j=d[i.sizset];break}if(1!==i.nodeType||f||(i.sizcache=c,i.sizset=g),i.nodeName.toLowerCase()===b){j=i;break}i=i[a]}d[g]=j}}}function r(a,b,c,d,e,f){for(var g=0,i=d.length;i>g;g++){var j=d[g];if(j){var k=!1;for(j=j[a];j;){if(j.sizcache===c){k=d[j.sizset];break}if(1===j.nodeType)if(f||(j.sizcache=c,j.sizset=g),"string"!=typeof b){if(j===b){k=!0;break}}else if(h.filter(b,[j]).length>0){k=j;break}j=j[a]}d[g]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,b=0,c=Object.prototype.toString,d=!1,e=!0,f=/\\/g,g=/\W/;[0,0].sort(function(){return e=!1,0});var h=function(b,d,e,f){e=e||[],d=d||document;var g=d;if(1!==d.nodeType&&9!==d.nodeType)return[];if(!b||"string"!=typeof b)return e;var k,l,n,o,p,q,r,t,u=!0,v=h.isXML(d),w=[],x=b;do if(a.exec(""),k=a.exec(x),k&&(x=k[3],w.push(k[1]),k[2])){o=k[3];break}while(k);if(w.length>1&&j.exec(b))if(2===w.length&&i.relative[w[0]])l=s(w[0]+w[1],d);else for(l=i.relative[w[0]]?[d]:h(w.shift(),d);w.length;)b=w.shift(),i.relative[b]&&(b+=w.shift()),l=s(b,l);else if(!f&&w.length>1&&9===d.nodeType&&!v&&i.match.ID.test(w[0])&&!i.match.ID.test(w[w.length-1])&&(p=h.find(w.shift(),d,v),d=p.expr?h.filter(p.expr,p.set)[0]:p.set[0]),d)for(p=f?{expr:w.pop(),set:m(f)}:h.find(w.pop(),1!==w.length||"~"!==w[0]&&"+"!==w[0]||!d.parentNode?d:d.parentNode,v),l=p.expr?h.filter(p.expr,p.set):p.set,w.length>0?n=m(l):u=!1;w.length;)q=w.pop(),r=q,i.relative[q]?r=w.pop():q="",null==r&&(r=d),i.relative[q](n,r,v);else n=w=[];if(n||(n=l),n||h.error(q||b),"[object Array]"===c.call(n))if(u)if(d&&1===d.nodeType)for(t=0;null!=n[t];t++)n[t]&&(n[t]===!0||1===n[t].nodeType&&h.contains(d,n[t]))&&e.push(l[t]);else for(t=0;null!=n[t];t++)n[t]&&1===n[t].nodeType&&e.push(l[t]);else e.push.apply(e,n);else m(n,e);return o&&(h(o,g,e,f),h.uniqueSort(e)),e};h.uniqueSort=function(a){if(o&&(d=e,a.sort(o),d))for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1);return a},h.matches=function(a,b){return h(a,null,null,b)},h.matchesSelector=function(a,b){return h(b,null,null,[a]).length>0},h.find=function(a,b,c){var d;if(!a)return[];for(var e=0,g=i.order.length;g>e;e++){var h,j=i.order[e];if(h=i.leftMatch[j].exec(a)){var k=h[1];if(h.splice(1,1),"\\"!==k.substr(k.length-1)&&(h[1]=(h[1]||"").replace(f,""),d=i.find[j](h,b,c),null!=d)){a=a.replace(i.match[j],"");break}}}return d||(d="undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName("*"):[]),{set:d,expr:a}},h.filter=function(a,b,c,d){for(var e,f,g=a,j=[],k=b,l=b&&b[0]&&h.isXML(b[0]);a&&b.length;){for(var m in i.filter)if(null!=(e=i.leftMatch[m].exec(a))&&e[2]){var n,o,p=i.filter[m],q=e[1];if(f=!1,e.splice(1,1),"\\"===q.substr(q.length-1))continue;if(k===j&&(j=[]),i.preFilter[m])if(e=i.preFilter[m](e,k,c,j,d,l)){if(e===!0)continue}else f=n=!0;if(e)for(var r=0;null!=(o=k[r]);r++)if(o){n=p(o,e,r,k);var s=d^!!n;c&&null!=n?s?f=!0:k[r]=!1:s&&(j.push(o),f=!0)}if(void 0!==n){if(c||(k=j),a=a.replace(i.match[m],""),!f)return[];break}}if(a===g){if(null!=f)break;h.error(a)}g=a}return k},h.error=function(a){throw"Syntax error, unrecognized expression: "+a};var i=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c="string"==typeof b,d=c&&!g.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var j,f=0,i=a.length;i>f;f++)if(j=a[f]){for(;(j=j.previousSibling)&&1!==j.nodeType;);a[f]=e||j&&j.nodeName.toLowerCase()===b?j||!1:j===b}e&&h.filter(b,a,!0)},">":function(a,b){var c,d="string"==typeof b,e=0,f=a.length;if(d&&!g.test(b)){for(b=b.toLowerCase();f>e;e++)if(c=a[e]){var i=c.parentNode;a[e]=i.nodeName.toLowerCase()===b?i:!1}}else{for(;f>e;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&h.filter(b,a,!0)}},"":function(a,c,d){var e,f=b++,h=r;"string"!=typeof c||g.test(c)||(c=c.toLowerCase(),e=c,h=q),h("parentNode",c,f,a,e,d)},"~":function(a,c,d){var e,f=b++,h=r;"string"!=typeof c||g.test(c)||(c=c.toLowerCase(),e=c,h=q),h("previousSibling",c,f,a,e,d)}},find:{ID:function(a,b,c){if("undefined"!=typeof b.getElementById&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if("undefined"!=typeof b.getElementsByName){for(var c=[],d=b.getElementsByName(a[1]),e=0,f=d.length;f>e;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return 0===c.length?null:c}},TAG:function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a[1]):void 0}},preFilter:{CLASS:function(a,b,c,d,e,g){if(a=" "+a[1].replace(f,"")+" ",g)return a;for(var i,h=0;null!=(i=b[h]);h++)i&&(e^(i.className&&(" "+i.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(i):c&&(b[h]=!1));return!1},ID:function(a){return a[1].replace(f,"")},TAG:function(a){return a[1].replace(f,"").toLowerCase()},CHILD:function(a){if("nth"===a[1]){a[2]||h.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var c=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec("even"===a[2]&&"2n"||"odd"===a[2]&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=c[1]+(c[2]||1)-0,a[3]=c[3]-0}else a[2]&&h.error(a[0]);return a[0]=b++,a},ATTR:function(a,b,c,d,e,g){var h=a[1]=a[1].replace(f,"");return!g&&i.attrMap[h]&&(a[1]=i.attrMap[h]),a[4]=(a[4]||a[5]||"").replace(f,""),"~="===a[2]&&(a[4]=" "+a[4]+" "),a},PSEUDO:function(b,c,d,e,f){if("not"===b[1]){if(!((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))){var g=h.filter(b[3],c,d,!0^f);return d||e.push.apply(e,g),!1}b[3]=h(b[3],null,null,c)}else if(i.match.POS.test(b[0])||i.match.CHILD.test(b[0]))return!0;return b},POS:function(a){return a.unshift(!0),a}},filters:{enabled:function(a){return a.disabled===!1&&"hidden"!==a.type},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!h(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return"input"===a.nodeName.toLowerCase()&&"text"===c&&(b===c||null===b)},radio:function(a){return"input"===a.nodeName.toLowerCase()&&"radio"===a.type},checkbox:function(a){return"input"===a.nodeName.toLowerCase()&&"checkbox"===a.type},file:function(a){return"input"===a.nodeName.toLowerCase()&&"file"===a.type},password:function(a){return"input"===a.nodeName.toLowerCase()&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return("input"===b||"button"===b)&&"submit"===a.type},image:function(a){return"input"===a.nodeName.toLowerCase()&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return("input"===b||"button"===b)&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return 0===b},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return 0===b%2},odd:function(a,b){return 1===b%2},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=i.filters[e];if(f)return f(a,c,b,d);if("contains"===e)return(a.textContent||a.innerText||h.getText([a])||"").indexOf(b[3])>=0;if("not"===e){for(var g=b[3],j=0,k=g.length;k>j;j++)if(g[j]===a)return!1;return!0}h.error(e)},CHILD:function(a,b){var c=b[1],d=a;switch(c){case"only":case"first":for(;d=d.previousSibling;)if(1===d.nodeType)return!1;if("first"===c)return!0;d=a;case"last":for(;d=d.nextSibling;)if(1===d.nodeType)return!1;return!0;case"nth":var e=b[2],f=b[3];if(1===e&&0===f)return!0;var g=b[0],h=a.parentNode;if(h&&(h.sizcache!==g||!a.nodeIndex)){var i=0;for(d=h.firstChild;d;d=d.nextSibling)1===d.nodeType&&(d.nodeIndex=++i);h.sizcache=g}var j=a.nodeIndex-f;return 0===e?0===j:0===j%e&&j/e>=0}},ID:function(a,b){return 1===a.nodeType&&a.getAttribute("id")===b},TAG:function(a,b){return"*"===b&&1===a.nodeType||a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=i.attrHandle[c]?i.attrHandle[c](a):null!=a[c]?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return null==d?"!="===f:"="===f?e===g:"*="===f?e.indexOf(g)>=0:"~="===f?(" "+e+" ").indexOf(g)>=0:g?"!="===f?e!==g:"^="===f?0===e.indexOf(g):"$="===f?e.substr(e.length-g.length)===g:"|="===f?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=i.setFilters[e];return f?f(a,c,b,d):void 0}}},j=i.match.POS,k=function(a,b){return"\\"+(b-0+1)};for(var l in i.match)i.match[l]=new RegExp(i.match[l].source+/(?![^\[]*\])(?![^\(]*\))/.source),i.leftMatch[l]=new RegExp(/(^(?:.|\r|\n)*?)/.source+i.match[l].source.replace(/\\(\d+)/g,k));var m=function(a,b){return a=Array.prototype.slice.call(a,0),b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(n){m=function(a,b){var d=0,e=b||[];if("[object Array]"===c.call(a))Array.prototype.push.apply(e,a);else if("number"==typeof a.length)for(var f=a.length;f>d;d++)e.push(a[d]);else for(;a[d];d++)e.push(a[d]);return e}}var o,p;document.documentElement.compareDocumentPosition?o=function(a,b){return a===b?(d=!0,0):a.compareDocumentPosition&&b.compareDocumentPosition?4&a.compareDocumentPosition(b)?-1:1:a.compareDocumentPosition?-1:1}:(o=function(a,b){if(a===b)return d=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,e,f=[],g=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i)return p(a,b);if(!h)return-1;if(!i)return 1;for(;j;)f.unshift(j),j=j.parentNode;for(j=i;j;)g.unshift(j),j=j.parentNode;c=f.length,e=g.length;for(var k=0;c>k&&e>k;k++)if(f[k]!==g[k])return p(f[k],g[k]);return k===c?p(a,g[k],-1):p(f[k],b,1)},p=function(a,b,c){if(a===b)return c;for(var d=a.nextSibling;d;){if(d===b)return-1;d=d.nextSibling}return 1}),h.getText=function(a){for(var c,b="",d=0;a[d];d++)c=a[d],3===c.nodeType||4===c.nodeType?b+=c.nodeValue:8!==c.nodeType&&(b+=h.getText(c.childNodes));return b},function(){var a=document.createElement("div"),b="script"+(new Date).getTime(),c=document.documentElement;a.innerHTML="<a name='"+b+"'/>",c.insertBefore(a,c.firstChild),document.getElementById(b)&&(i.find.ID=function(a,b,c){if("undefined"!=typeof b.getElementById&&!c){var d=b.getElementById(a[1]);return d?d.id===a[1]||"undefined"!=typeof d.getAttributeNode&&d.getAttributeNode("id").nodeValue===a[1]?[d]:void 0:[]}},i.filter.ID=function(a,b){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return 1===a.nodeType&&c&&c.nodeValue===b}),c.removeChild(a),c=a=null}(),function(){var a=document.createElement("div");a.appendChild(document.createComment("")),a.getElementsByTagName("*").length>0&&(i.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if("*"===a[1]){for(var d=[],e=0;c[e];e++)1===c[e].nodeType&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&"undefined"!=typeof a.firstChild.getAttribute&&"#"!==a.firstChild.getAttribute("href")&&(i.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),document.querySelectorAll&&function(){var a=h,b=document.createElement("div"),c="__sizzle__";if(b.innerHTML="<p class='TEST'></p>",!b.querySelectorAll||0!==b.querySelectorAll(".TEST").length){h=function(b,d,e,f){if(d=d||document,!f&&!h.isXML(d)){var g=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(g&&(1===d.nodeType||9===d.nodeType)){if(g[1])return m(d.getElementsByTagName(b),e);if(g[2]&&i.find.CLASS&&d.getElementsByClassName)return m(d.getElementsByClassName(g[2]),e)}if(9===d.nodeType){if("body"===b&&d.body)return m([d.body],e);if(g&&g[3]){var j=d.getElementById(g[3]);if(!j||!j.parentNode)return m([],e);if(j.id===g[3])return m([j],e)}try{return m(d.querySelectorAll(b),e)}catch(k){}}else if(1===d.nodeType&&"object"!==d.nodeName.toLowerCase()){var l=d,n=d.getAttribute("id"),o=n||c,p=d.parentNode,q=/^\s*[+~]/.test(b);n?o=o.replace(/'/g,"\\$&"):d.setAttribute("id",o),q&&p&&(d=d.parentNode);try{if(!q||p)return m(d.querySelectorAll("[id='"+o+"'] "+b),e)}catch(r){}finally{n||l.removeAttribute("id")}}}return a(b,d,e,f)};for(var d in a)h[d]=a[d];b=null}}(),function(){var a=document.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var c=!b.call(document.createElement("div"),"div"),d=!1;try{b.call(document.documentElement,"[test!='']:sizzle")}catch(e){d=!0}h.matchesSelector=function(a,e){if(e=e.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!h.isXML(a))try{if(d||!i.match.PSEUDO.test(e)&&!/!=/.test(e)){var f=b.call(a,e);if(f||!c||a.document&&11!==a.document.nodeType)return f}}catch(g){}return h(e,null,null,[a]).length>0}}}(),function(){var a=document.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>",a.getElementsByClassName&&0!==a.getElementsByClassName("e").length&&(a.lastChild.className="e",1!==a.getElementsByClassName("e").length&&(i.order.splice(1,0,"CLASS"),i.find.CLASS=function(a,b,c){return"undefined"==typeof b.getElementsByClassName||c?void 0:b.getElementsByClassName(a[1])},a=null))}(),h.contains=document.documentElement.contains?function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:document.documentElement.compareDocumentPosition?function(a,b){return!!(16&a.compareDocumentPosition(b))}:function(){return!1},h.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?"HTML"!==b.nodeName:!1};var s=function(a,b){for(var c,d=[],e="",f=b.nodeType?[b]:b;c=i.match.PSEUDO.exec(a);)e+=c[0],a=a.replace(i.match.PSEUDO,"");a=i.relative[a]?a+"*":a;for(var g=0,j=f.length;j>g;g++)h(a,f[g],d);return h.filter(e,d)};window.Sizzle=h}(),Animator.prototype={setOptions:function(a){this.options=Animator.applyDefaults({interval:20,duration:400,onComplete:function(){},onStep:function(){},transition:Animator.tx.easeInOut},a)},seekTo:function(a){this.seekFromTo(this.state,a)},seekFromTo:function(a,b){this.target=Math.max(0,Math.min(1,b)),this.state=Math.max(0,Math.min(1,a)),this.lastTime=(new Date).getTime(),this.intervalId||(this.intervalId=window.setInterval(this.timerDelegate,this.options.interval))},jumpTo:function(a){this.target=this.state=Math.max(0,Math.min(1,a)),this.propagate()},toggle:function(){this.seekTo(1-this.target)},addSubject:function(a){return this.subjects[this.subjects.length]=a,this},clearSubjects:function(){this.subjects=[]},propagate:function(){for(var a=this.options.transition(this.state),b=0;b<this.subjects.length;b++)this.subjects[b].setState?this.subjects[b].setState(a):this.subjects[b](a)},onTimerEvent:function(){var a=(new Date).getTime(),b=a-this.lastTime;this.lastTime=a;var c=b/this.options.duration*(this.state<this.target?1:-1);Math.abs(c)>=Math.abs(this.state-this.target)?this.state=this.target:this.state+=c;try{this.propagate()}finally{this.options.onStep.call(this),this.target==this.state&&this.stop()}},stop:function(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.options.onComplete.call(this))},play:function(){this.seekFromTo(0,1)},reverse:function(){this.seekFromTo(1,0)},inspect:function(){for(var a="#<Animator:\n",b=0;b<this.subjects.length;b++)a+=this.subjects[b].inspect();return a+=">"}},Animator.applyDefaults=function(a,b){b=b||{};var c,d={};for(c in a)d[c]=void 0!==b[c]?b[c]:a[c];return d},Animator.makeArrayOfElements=function(a){if(null==a)return[];if("string"==typeof a)return[document.getElementById(a)];if(!a.length)return[a];for(var b=[],c=0;c<a.length;c++)b[c]="string"==typeof a[c]?document.getElementById(a[c]):a[c];return b},Animator.camelize=function(a){var b=a.split("-");if(1==b.length)return b[0];for(var c=0==a.indexOf("-")?b[0].charAt(0).toUpperCase()+b[0].substring(1):b[0],d=1,e=b.length;e>d;d++){var f=b[d];c+=f.charAt(0).toUpperCase()+f.substring(1)}return c},Animator.apply=function(a,b,c){return b instanceof Array?new Animator(c).addSubject(new CSSStyleSubject(a,b[0],b[1])):new Animator(c).addSubject(new CSSStyleSubject(a,b))},Animator.makeEaseIn=function(a){return function(b){return Math.pow(b,2*a)}},Animator.makeEaseOut=function(a){return function(b){return 1-Math.pow(1-b,2*a)}},Animator.makeElastic=function(a){return function(b){return b=Animator.tx.easeInOut(b),(1-Math.cos(b*Math.PI*a))*(1-b)+b}},Animator.makeADSR=function(a,b,c,d){return null==d&&(d=.5),function(e){return a>e?e/a:b>e?1-(e-a)/(b-a)*(1-d):c>e?d:d*(1-(e-c)/(1-c))}},Animator.makeBounce=function(a){var b=Animator.makeElastic(a);return function(a){return a=b(a),1>=a?a:2-a}},Animator.tx={easeInOut:function(a){return-Math.cos(a*Math.PI)/2+.5},linear:function(a){return a},easeIn:Animator.makeEaseIn(1.5),easeOut:Animator.makeEaseOut(1.5),strongEaseIn:Animator.makeEaseIn(2.5),strongEaseOut:Animator.makeEaseOut(2.5),elastic:Animator.makeElastic(1),veryElastic:Animator.makeElastic(3),bouncy:Animator.makeBounce(1),veryBouncy:Animator.makeBounce(3)},NumericalStyleSubject.prototype={setState:function(a){var b=this.getStyle(a);"opacity"==this.property&&0==a?"hidden":"";for(var d=0,e=0;e<this.els.length;e++){try{this.els[e].style[this.property]=b}catch(f){if("fontWeight"!=this.property)throw f}if(d++>20)return}},getStyle:function(a){return a=this.from+(this.to-this.from)*a,"opacity"==this.property?a:Math.round(a)+this.units},inspect:function(){return"	"+this.property+"("+this.from+this.units+" to "+this.to+this.units+")\n"}},ColorStyleSubject.prototype={expandColor:function(a){var b,c,d,e;return(b=ColorStyleSubject.parseColor(a))?(c=parseInt(b.slice(1,3),16),d=parseInt(b.slice(3,5),16),e=parseInt(b.slice(5,7),16),[c,d,e]):(window.ANIMATOR_DEBUG&&alert("Invalid colour: '"+a+"'"),void 0)},getValueForState:function(a,b){return Math.round(this.from[a]+(this.to[a]-this.from[a])*b)},setState:function(a){for(var b="#"+ColorStyleSubject.toColorPart(this.getValueForState(0,a))+ColorStyleSubject.toColorPart(this.getValueForState(1,a))+ColorStyleSubject.toColorPart(this.getValueForState(2,a)),c=0;c<this.els.length;c++)this.els[c].style[this.property]=b},inspect:function(){return"	"+this.property+"("+this.origFrom+" to "+this.origTo+")\n"}},ColorStyleSubject.parseColor=function(a){var c,b="#";if(c=ColorStyleSubject.parseColor.rgbRe.exec(a)){for(var d,e=1;3>=e;e++)d=Math.max(0,Math.min(255,parseInt(c[e]))),b+=ColorStyleSubject.toColorPart(d);return b}if(c=ColorStyleSubject.parseColor.hexRe.exec(a)){if(3==c[1].length){for(var e=0;3>e;e++)b+=c[1].charAt(e)+c[1].charAt(e);return b}return"#"+c[1]}return!1},ColorStyleSubject.toColorPart=function(a){a>255&&(a=255);var b=a.toString(16);return 16>a?"0"+b:b},ColorStyleSubject.parseColor.rgbRe=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,ColorStyleSubject.parseColor.hexRe=/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,DiscreteStyleSubject.prototype={setState:function(a){for(var c=0;c<this.els.length;c++)this.els[c].style[this.property]=a<=this.threshold?this.from:this.to},inspect:function(){return"	"+this.property+"("+this.from+" to "+this.to+" @ "+this.threshold+")\n"}},CSSStyleSubject.prototype={parseStyle:function(a,b){var c={};if(-1!=a.indexOf(":"))for(var d=a.split(";"),e=0;e<d.length;e++){var f=CSSStyleSubject.ruleRe.exec(d[e]);f&&(c[f[1]]=f[2])}else{var g,h,i;i=b.className,b.className=a;for(var e=0;e<CSSStyleSubject.cssProperties.length;e++)g=CSSStyleSubject.cssProperties[e],h=CSSStyleSubject.getStyle(b,g),null!=h&&(c[g]=h);b.className=i}return c},setState:function(a){for(var b=0;b<this.subjects.length;b++)this.subjects[b].setState(a)},inspect:function(){for(var a="",b=0;b<this.subjects.length;b++)a+=this.subjects[b].inspect();return a}},CSSStyleSubject.getStyle=function(a,b){var c;return document.defaultView&&document.defaultView.getComputedStyle&&(c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b))?c:(b=Animator.camelize(b),a.currentStyle&&(c=a.currentStyle[b]),c||a.style[b])},CSSStyleSubject.ruleRe=/^\s*([a-zA-Z\-]+)\s*:\s*(\S(.+\S)?)\s*$/,CSSStyleSubject.numericalRe=/^-?\d+(?:\.\d+)?(%|[a-zA-Z]{2})?$/,CSSStyleSubject.discreteRe=/^\w+$/,CSSStyleSubject.cssProperties=["azimuth","background","background-attachment","background-color","background-image","background-position","background-repeat","border-collapse","border-color","border-spacing","border-style","border-top","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","border-top-width","border-right-width","border-bottom-width","border-left-width","border-width","bottom","clear","clip","color","content","cursor","direction","display","elevation","empty-cells","css-float","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","height","left","letter-spacing","line-height","list-style","list-style-image","list-style-position","list-style-type","margin","margin-top","margin-right","margin-bottom","margin-left","max-height","max-width","min-height","min-width","orphans","outline","outline-color","outline-style","outline-width","overflow","padding","padding-top","padding-right","padding-bottom","padding-left","pause","position","right","size","table-layout","text-align","text-decoration","text-indent","text-shadow","text-transform","top","vertical-align","visibility","white-space","width","word-spacing","z-index","opacity","outline-offset","overflow-x","overflow-y"],AnimatorChain.prototype={setOptions:function(a){this.options=Animator.applyDefaults({resetOnPlay:!0},a)},play:function(){if(this.forwards=!0,this.current=-1,this.options.resetOnPlay)for(var a=0;a<this.animators.length;a++)this.animators[a].jumpTo(0);this.advance()},reverse:function(){if(this.forwards=!1,this.current=this.animators.length,this.options.resetOnPlay)for(var a=0;a<this.animators.length;a++)this.animators[a].jumpTo(1);this.advance()},toggle:function(){this.forwards?this.seekTo(0):this.seekTo(1)},listenTo:function(a){var b=a.options.onComplete,c=this;a.options.onComplete=function(){b&&b.call(a),c.advance()}},advance:function(){if(this.forwards){if(null==this.animators[this.current+1])return;this.current++,this.animators[this.current].play()}else{if(null==this.animators[this.current-1])return;this.current--,this.animators[this.current].reverse()}},seekTo:function(a){0>=a?(this.forwards=!1,this.animators[this.current].seekTo(0)):(this.forwards=!0,this.animators[this.current].seekTo(1))}},AudioFX=function(){var a=!1,b=document.createElement("audio"),c=function(a){var c=b.canPlayType(a);return"probably"===c||"maybe"===c};b&&b.canPlayType&&(a={ogg:c('audio/ogg; codecs="vorbis"'),mp3:c("audio/mpeg;"),wav:c('audio/wav; codecs="1"'),loop:"boolean"==typeof b.loop});var d=function(a){return!a.paused&&!a.ended},e=function(b,c,d){var e=document.createElement("audio");if(d){var f=function(){e.removeEventListener("canplay",f,!1),d()};e.addEventListener("canplay",f,!1)}return c.loop&&!a.loop&&e.addEventListener("ended",function(){e.stop(),e.currentTime=3,e.play()},!1),e.volume=c.volume||.2,e.loop=c.loop,e.src=b,e},f=function(b,c,f){var g=[];if(a)for(var h=0;h<(c.pool||1);h++)g.push(e(b,c,0==h?f:null));else f();var i=function(){var a,b;for(a=0;a<g.length;a++)if(b=g[a],b.paused||b.ended)return b};return{audio:1==g.length?g[0]:g,play:function(){var a=i();a&&a.play()},stop:function(){var a,b;for(a=0;a<g.length;a++)b=g[a],d(b)&&(b.pause(),b.currentTime=0)},time:function(a){var b,c;for(b=0;b<g.length;b++)c=g[b],d(c)&&(c.currentTime=a)}}},g=function(b,c,d){c=c||{};var e=b,g=c.formats;if(g)for(var h=0;h<g.length;h++)if(a&&a[g[h]]){e=e+"."+g[h];break}return f(e,c,d)};return g.enabled=a,g}(),StateMachine={VERSION:"2.0.0",create:function(a,b){var c="string"==typeof a.initial?{state:a.initial}:a.initial,d=b||a.target||{},e=a.events||[],f=a.callbacks||{},g={},h=function(a){var b=a.from instanceof Array?a.from:[a.from];g[a.name]=g[a.name]||{};for(var c=0;c<b.length;c++)g[a.name][b[c]]=a.to};c&&(c.event=c.event||"startup",h({name:c.event,from:"none",to:c.state}));for(var i=0;i<e.length;i++)h(e[i]);for(var j in g)g.hasOwnProperty(j)&&(d[j]=StateMachine.buildEvent(j,g[j]));for(var j in f)f.hasOwnProperty(j)&&(d[j]=f[j]);return d.current="none",d.is=function(a){return this.current==a},d.can=function(a){return!!g[a][this.current]&&!this.transition},d.cannot=function(a){return!this.can(a)},c&&!c.defer&&d[c.event](),d},beforeEvent:function(a,b,c,d){var e=this["onbefore"+a];return e?e.apply(this,[a,b,c].concat(d)):void 0},afterEvent:function(a,b,c,d){var e=this["onafter"+a]||this["on"+a];return e?e.apply(this,[a,b,c].concat(d)):void 0},leaveState:function(a,b,c,d){var e=this["onleave"+b];return e?e.apply(this,[a,b,c].concat(d)):void 0},enterState:function(a,b,c,d){var e=this["onenter"+c]||this["on"+c];return e?e.apply(this,[a,b,c].concat(d)):void 0},changeState:function(a,b,c,d){var e=this.onchangestate;return e?e.apply(this,[a,b,c].concat(d)):void 0},buildEvent:function(a,b){return function(){if(this.transition)throw"event "+a+" innapropriate because previous transition did not complete";if(this.cannot(a))throw"event "+a+" innapropriate in current state "+this.current;var c=this.current,d=b[c],e=Array.prototype.slice.call(arguments);if(this.current!=d){if(!1===StateMachine.beforeEvent.call(this,a,c,d,e))return;var f=this;this.transition=function(){f.transition=null,f.current=d,StateMachine.enterState.call(f,a,c,d,e),StateMachine.changeState.call(f,a,c,d,e),StateMachine.afterEvent.call(f,a,c,d,e)},!1!==StateMachine.leaveState.call(this,a,c,d,e)&&this.transition&&this.transition()}}}},userAgent=function(){var a=navigator.userAgent.toLowerCase(),b=a.indexOf("opera")>-1?"opera":null;b=b||(a.indexOf("firefox")>-1?"firefox":null),b=b||(a.indexOf("chrome")>-1?"chrome":null),b=b||(a.indexOf("safari")>-1?"safari":null),b=b||(a.indexOf("msie")>-1?"ie":null);try{var c="ie"==b?"msie (\\d)":b+"\\/(\\d\\.\\d)",d=a.match(new RegExp(c,"i")),e=d?parseFloat(d[1]):null}catch(f){}return{full:a,name:b+(e?" "+e.toString():""),version:e,isFirefox:"firefox"==b,isChrome:"chrome"==b,isSafari:"safari"==b,isOpera:"opera"==b,isIE:"ie"==b,hasAudio:AudioFX&&AudioFX.enabled,hasCanvas:document.createElement("canvas").getContext,hasTouch:"ontouchstart"in window}}(),is={string:function(a){return"string"==typeof a},number:function(a){return"number"==typeof a},bool:function(a){return"boolean"==typeof a},array:function(a){return a instanceof Array},undefined:function(a){return"undefined"==typeof a},"null":function(a){return null===a},notNull:function(a){return null!==a},invalid:function(a){return is["null"](a)||is.undefined(a)},valid:function(a){return!is["null"](a)&&!is.undefined(a)},emptyString:function(a){return is.string(a)&&0==a.length},nonEmptyString:function(a){return is.string(a)&&a.length>0},emptyArray:function(a){return is.array(a)&&0==a.length},nonEmptyArray:function(a){return is.array(a)&&a.length>0},document:function(a){return a===document},window:function(a){return a===window},element:function(a){return a instanceof HTMLElement},event:function(a){return a instanceof Event},link:function(a){return is.element(a)&&"A"==a.tagName}},toBool=function(a,b){return is.valid(a)?1==a||1==a||"1"==a||"true"==a.toString().toLowerCase()||"yes"==a.toString().toLowerCase():is.bool(b)?b:!1},toInt=function(a,b){if(is.valid(a)){var c=parseInt(a,10);if(!isNaN(c))return c}return is.number(b)?b:0},toString=function(a,b){return is.valid(a)?a.toString():is.string(b)?b:""},toFloat=function(a,b){if(is.valid(a)){var c=parseFloat(a);if(!isNaN(c))return c}return is.number(b)?b:0},Function.prototype.bind||(Function.prototype.bind=function(a){var b=[].slice,c=b.call(arguments,1),d=this,e=function(){},f=function(){return d.apply(this instanceof e?this:a||{},c.concat(b.call(arguments)))};return e.prototype=d.prototype,f.prototype=new e,f}),Object.create||(Object.create=function(a){function b(){}return b.prototype=a,new b}),Object.extend||(Object.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a});var Class={create:function(a,b){var c=function(){return this.initialize?this.initialize.apply(this,arguments):void 0};return c.prototype=a||{},Object.extend(c,b||{}),c}};window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}),Game={ready:function(){var a=[];return document.addEventListener("DOMContentLoaded",function(){for(var b=0;b<a.length;b++)a[b]();a=!0},!1),function(b){a===!0?b():a.push(b)}}(),Runner:Class.create({initialize:function(a,b,c){this.game=b,this.cfg=c||{},this.canvas=$(a),this.bounds=this.canvas.getBoundingClientRect(),this.width=this.cfg.width||this.canvas.offsetWidth,this.height=this.cfg.height||this.canvas.offsetHeight,this.canvas=this.canvas,this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.addEvents(),toBool(c.start)&&this.start()},start:function(){var c,d,e,a=function(){return(new Date).getTime()},f=a(),g=!1,h=this,i=function(){c=a(),h.update(Math.min(.1,(c-f)/1e3)),d=a(),h.draw(),e=a(),f=c,g||requestAnimationFrame(i)
};this.stop=function(){g=!0},i()},update:function(a){a=Math.min(a,500),this.game.update(a)},draw:function(){this.ctx.save(),this.game.draw(this.ctx),this.ctx.restore()},addEvents:function(){$(window).on("resize",this.onresize.bind(this));var a=this.game;a.onfocus&&(document.body.tabIndex=toInt(document.body.tabIndex,0),$(document.body).on("focus",function(b){a.onfocus(b)})),a.onclick&&$(document).on("click",function(b){a.onclick(b)})},onresize:function(){this.onresizeTimer&&clearTimeout(this.onresizeTimer),this.onresizeTimer=setTimeout(this.onresizeend.bind(this),50)},onresizeend:function(){this.resize()},resize:function(){(this.width!=this.canvas.offsetWidth||this.height!=this.canvas.offsetHeight)&&(this.width=this.canvas.width=this.canvas.offsetWidth,this.height=this.canvas.height=this.canvas.offsetHeight,this.game&&this.game.onresize&&this.game.onresize(this.width,this.height))}}),storage:function(){try{return this.localStorage=this.localStorage||window.localStorage||{}}catch(a){return this.localStorage={}}},renderToCanvas:function(a,b,c,d){return d=d||document.createElement("canvas"),d.width=a,d.height=b,c(d.getContext("2d")),d},createImage:function(a,b){b=b||{};var c=$({tag:"img"});return b.onload&&c.on("load",b.onload),c.src=a,c},loadResources:function(a,b,c){a=a||[],b=b||[];var d=a.length+b.length,e={images:{},sounds:{}};if(0==d)c(e);else{for(var f=!1,g=function(){f||(f=!0,c(e))},h=function(){0==--d&&g()},i=0;i<a.length;i++){var j=a[i];j=is.string(j)?{id:j,url:j}:j,e.images[j.id]=Game.createImage(j.url,{onload:h})}for(var i=0;i<b.length;i++){var k=b[i];k=is.string(k)?{id:k,name:k}:k,e.sounds[k.id]=AudioFX(k.name,k,h)}setTimeout(g,4e3)}}},Game.Element=function(){var a=function(a,b){return is.array(b)?Sizzle.matches(a,b):Sizzle(a,b)},b=function(a){if(is.array(a))for(var c=0,d=a.length;d>c;c++)a[c]=b(a[c]);else a._extended||Object.extend(a,Game.Element.instanceMethods);return a},c=function(a,b,c,d){a.addEventListener(b,c,d)},d=function(a,b,c,d){a.removeEventListener(b,c,d)},e=function(a){var b=document.createElement(a.tag);for(var d in a)if(a.hasOwnProperty(d)&&is.valid(a[d]))switch(d){case"tag":break;case"html":b.innerHTML=a[d];break;case"text":b.appendChild(document.createTextNode(a[d]));break;case"dom":a[d]=is.array(a[d])?a[d]:[a[d]];for(var e=0;e<a[d].length;e++)b.appendChild(a[d][e]);break;case"class":case"klass":case"className":b.className=a[d];break;case"on":for(var f in a[d])c(b,f,a[d][f]);break;default:b.setAttribute(d,a[d])}return b};return{all:function(c,d){return b(a(c,d))},get:function(c,d){if(is.string(c))return b(a("#"+c,d)[0]);if(is.element(c)||is.window(c)||is.document(c))return b(c);if(is.event(c))return b(c.target||c.srcElement);if("object"==typeof c&&c.tag)return b(e(c));throw"not an appropriate type for DOM wrapping: "+ele},instanceMethods:{_extended:!0,on:function(a,b,d){c(this,a,b,d)},un:function(a,b,c){d(this,a,b,c)},showIf:function(a){a?this.show():this.hide()},show:function(){this.style.display=""},hide:function(){this.style.display="none"},visible:function(){return"none"!=this.style.display&&!this.fading},fade:function(a){this.style.opacity=a},relations:function(a,c){for(var d=c?[this]:[],e=this;e=e[a];)1==e.nodeType&&d.push(e);return b(d)},parent:function(){return b(this.parentNode)},ancestors:function(a){return this.relations("parentNode",a)},previousSiblings:function(){return this.relations("previousSibling")},nextSiblings:function(){return this.relations("nextSibling")},select:function(a){return Game.Element.all(a,this)},down:function(a){return Game.Element.all(a,this)[0]},up:function(a,b){return Game.Element.all(a,this.ancestors(b))[0]},prev:function(a){return Game.Element.all(a,this.previousSiblings())[0]},next:function(a){return Game.Element.all(a,this.nextSiblings())[0]},remove:function(){return this.parentNode&&this.parentNode.removeChild(this),this},removeChildren:function(){for(;this.childNodes.length>0;)this.removeChild(this.childNodes[0]);return this},update:function(a){this.innerHTML="",this.append(a)},append:function(a){if(is.string(a))this.innerHTML+=a;else if(is.array(a))for(var b=0;b<a.length;b++)this.append(a[b]);else this.appendChild(Game.Element.get(a))},setClassName:function(a){this.className=a},hasClassName:function(a){return new RegExp("(^|s*)"+a+"(s*|$)").test(this.className)},addClassName:function(a){this.toggleClassName(a,!0)},removeClassName:function(a){this.toggleClassName(a,!1)},toggleClassName:function(a,b){var c=this.className.split(" "),d=c.indexOf(a);b="undefined"==typeof b?0>d:b,b&&0>d?c.push(a):!b&&d>=0&&c.splice(d,1),this.className=c.join(" ")},fadeout:function(a){a=a||{},this.cancelFade(),this.fading=Animator.apply(this,"opacity: 0",{duration:a.duration,onComplete:function(){this.hide(),this.fading=null,this.style.opacity=is.ie?1:null,a.onComplete&&a.onComplete()}.bind(this)}),this.fading.play()},fadein:function(a){a=a||{},this.cancelFade(),this.style.opacity=0,this.show(),this.fading=Animator.apply(this,"opacity: 1",{duration:a.duration,onComplete:function(){this.fading=null,this.style.opacity=is.ie?1:null,a.onComplete&&a.onComplete()}.bind(this)}),this.fading.play()},cancelFade:function(){this.fading&&(this.fading.stop(),delete this.fading)}}}}(),$=Game.Element.get,$$=Game.Element.all,Game.Event={stop:function(a){return a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}},Game.Menu=Class.create({initialize:function(a,b,c){this.parent=$(a),this.game=b,this.cfg=c,this.construct(c.id,c.items,toBool(c.visible,!0)),Game.Key.map([{keys:[Game.Key.UP,Game.Key.W],mode:"down",action:function(){this.prev()}},{keys:[Game.Key.DOWN,Game.Key.S],mode:"down",action:function(){this.next()}},{keys:[Game.Key.LEFT,Game.Key.A],mode:"down",action:function(){this.prevChoice()}},{keys:[Game.Key.RIGHT,Game.Key.D],mode:"down",action:function(){this.nextChoice()}},{keys:[Game.Key.SPACE,Game.Key.RETURN],mode:"down",action:function(){this.click()}}],this,{ele:this.dom})},destruct:function(){this.dom&&(this.dom.remove(),this.dom=null,this.items=null)},construct:function(a,b,c){var d=c?"":"display: none;";this.destruct(),this.dom=$({tag:"div",id:a,klass:"menu",style:d,on:{mousemove:this.onmousemove.bind(this),click:this.onclick.bind(this)}}),this.tabindex=10,this.items=[];for(var e=0;e<b.length;e++)this.items.push(this.constructItem(e,b[e]));this.parent.append(this.dom),this.select(0)},constructItem:function(a,b){var c=$({tag:"span",klass:"item",style:"cursor: pointer;",text:b.text,title:b.title,id:b.id,tabindex:b.tabindex||this.tabindex++,on:{focus:this.onfocusitem.bind(this)}});return c.cfg=b,c.index=a,c.action=b.choice?this.nextChoice.bind(this,c,!0):b.action,this.setChoice(c,b.chosen),this.dom.append({tag:"div",dom:c}),c},prevChoice:function(a,b){a=a||this.selectedItem(),a.cfg.choice&&(a.cfg.chosen>0?this.setChoice(a,a.cfg.chosen-1):b&&this.setChoice(a,a.cfg.choice.length-1))},nextChoice:function(a,b){a=a||this.selectedItem(),a.cfg.choice&&(a.cfg.chosen<a.cfg.choice.length-1?this.setChoice(a,a.cfg.chosen+1):b&&this.setChoice(a,0))},setChoice:function(a,b){if(a.cfg.choice){var c=a.cfg.choice,d=a.cfg.chosen=toInt(b,0),e=$({tag:"span",klass:"choice",text:a.cfg.choice[d]}),f=$({tag:"span",klass:"prev",text:0==d?"":"<"}),g=$({tag:"span",klass:"next",text:d==c.length-1?"":">"});d>0&&f.on("click",function(b){this.prevChoice(a,!1),Game.Event.stop(b)}.bind(this)),d<c.length-1&&g.on("click",function(b){this.nextChoice(a,!1),Game.Event.stop(b)}.bind(this)),a.update([f,e,g]),a.cfg.action.call(this.game,a.cfg.chosen)}},item:function(a){return $(a).up(".item",!0)},selectedItem:function(){return this.dom.down(".selected")},selectedIndex:function(){return this.selectedItem().index},firstItem:function(){return this.dom.down(".item:first")},lastItem:function(){return this.dom.down(".item:last")},onfocusitem:function(a){this.select(this.item(a))},onmousemove:function(a){this.select(this.item(a))},prev:function(){this.select(this.selectedIndex()-1)},next:function(){this.select(this.selectedIndex()+1)},click:function(){var a=this.selectedItem();a&&a.action&&(this.cfg.onclick&&this.cfg.onclick.call(this.game,a),a.action.call(this.game))},onclick:function(a){return this.dom.visible()&&this.click(this.item(a)),Game.Event.stop(a)},select:function(a){if(is.valid(a)){var b=this.selectedItem(),c=is.number(a)?this.items[Math.min(Math.max(a,0),this.items.length-1)]:a;b!=c&&(b&&b.removeClassName("selected"),c&&(c.addClassName("selected"),c.focus()),this.dom.visible()&&this.cfg.onselect&&this.cfg.onselect.call(this.game,b))}},focus:function(){this.selectedItem().focus()},hide:function(){this.dom.hide()},show:function(){this.dom.show(),this.selectedItem().focus()},fadeout:function(a){this.dom.fadeout(a)},fadein:function(a){a=a||{};var b=a.onComplete;a.onComplete=function(){this.selectedItem().focus(),b&&b()}.bind(this),this.dom.fadein(a)}}),Game.Key={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,SPACE:32,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PAGEUP:33,PAGEDOWN:34,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,TILDA:192,map:function(a,b,c){c=c||{};var d=$(c.ele||document),e=function(c,e,f){var g,h;if(d===document||d.visible())for(g=0;g<a.length;++g)if(h=a[g],h.mode=h.mode||"up",Game.Key.match(h,e,f,b))return h.action.call(b,e),Game.Event.stop(c)};d.on("keydown",function(a){return e(a,a.keyCode,"down")}),d.on("keyup",function(a){return e(a,a.keyCode,"up")})},match:function(a,b,c,d){return a.mode!==c||a.state&&d&&a.state!==d.current||!(a.key===b||a.keys&&a.keys.indexOf(b)>=0)?!1:!0}},Game.Math={THREESIXTY:2*Math.PI,minmax:function(a,b,c){return Math.max(b,Math.min(c,a))},random:function(a,b){return a+Math.random()*(b-a)},randomChoice:function(a){return a[Math.round(Game.random(0,a.length-1))]},randomBool:function(){return Game.randomChoice([!0,!1])},between:function(a,b,c){return a>=b&&c>=a},brighten:function(a,b){var c=parseInt(a.substr(1,2),16),d=parseInt(a.substr(3,2),16),e=parseInt(a.substr(5,2),16);return"#"+(0|256+c+(256-c)*b/100).toString(16).substr(1)+(0|256+d+(256-d)*b/100).toString(16).substr(1)+(0|256+e+(256-e)*b/100).toString(16).substr(1)},bound:function(a){return a.radius?(a.w=2*a.radius,a.h=2*a.radius,a.left=a.x-a.radius,a.right=a.x+a.radius,a.top=a.y-a.radius,a.bottom=a.y+a.radius):(a.left=a.x,a.right=a.x+a.w,a.top=a.y,a.bottom=a.y+a.h),a},overlap:function(a,b,c){if(a.right<b.left||a.left>b.right||a.top>b.bottom||a.bottom<b.top)return!1;if(c){var d=Math.max(a.left,b.left),e=Math.min(a.right,b.right),f=Math.max(a.top,b.top),g=Math.min(a.bottom,b.bottom);return{x:d,y:f,w:e-d,h:g-f,left:d,right:e,top:f,bottom:g}}return!0},normalize:function(a,b){return a.m=this.magnitude(a.x,a.y),0==a.m?a.x=a.y=a.m=0:(a.m=a.m/(b||1),a.x=a.x/a.m,a.y=a.y/a.m,a.m=a.m/a.m),a},magnitude:function(a,b){return Math.sqrt(a*a+b*b)},move:function(a,b,c,d,e){var f=c*e,g=d*e;return{x:a+f,y:b+g,dx:c,dy:d,nx:f,ny:g}},accelerate:function(a,b,c,d,e,f){var g=a+f*c+.5*e*f*f,h=b+f*d+.5*e*f*f,i=c+e*f*(c>0?1:-1),j=d+e*f*(d>0?1:-1);return{nx:g-a,ny:h-b,x:g,y:h,dx:i,dy:j}},intercept:function(a,b,c,d,e,f,g,h,i){var j=(h-f)*(c-a)-(g-e)*(d-b);if(0!=j){var k=((g-e)*(b-f)-(h-f)*(a-e))/j;if(k>=0&&1>=k){var l=((c-a)*(b-f)-(d-b)*(a-e))/j;if(l>=0&&1>=l){var m=a+k*(c-a),n=b+k*(d-b);return{x:m,y:n,d:i}}}}return null},ballIntercept:function(a,b,c,d){var e;return 0>c?e=Game.Math.intercept(a.x,a.y,a.x+c,a.y+d,b.right+a.radius,b.top-a.radius,b.right+a.radius,b.bottom+a.radius,"right"):c>0&&(e=Game.Math.intercept(a.x,a.y,a.x+c,a.y+d,b.left-a.radius,b.top-a.radius,b.left-a.radius,b.bottom+a.radius,"left")),e||(0>d?e=Game.Math.intercept(a.x,a.y,a.x+c,a.y+d,b.left-a.radius,b.bottom+a.radius,b.right+a.radius,b.bottom+a.radius,"bottom"):d>0&&(e=Game.Math.intercept(a.x,a.y,a.x+c,a.y+d,b.left-a.radius,b.top-a.radius,b.right+a.radius,b.top-a.radius,"top"))),e}},Game.Vector=Game.Point=Class.create({initialize:function(a,b,c){this.x=a,this.y=b,this.dir=c},equals:function(a){return this.x==a.x&&this.y==a.y},blank:function(){return is.invalid(this.x)||is.invalid(this.y)}});