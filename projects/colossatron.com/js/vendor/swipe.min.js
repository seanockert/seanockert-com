/*
 * Swipe 2.0
 *
 * Brad Birdsall
 * Copyright 2012, Licensed GPL & MIT
 *
*/
window.Swipe=function(a,b){var c=this;a&&(this.container=a,this.element=this.container.children[0],this.browser={touch:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}(),transitions:function(){var a=document.createElement("swipe"),b=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var c in b)if(void 0!==a.style[b[c]])return!0;return!1}()},b=b||{},this.index=b.startSlide||0,this.speed=b.speed||300,this.callback=b.callback||function(){},this.transitionEnd=b.transitionEnd||function(){},this.delay=b.auto||0,this.cont=void 0!=b.continuous?!!b.continuous:!0,this.disableScroll=!!b.disableScroll,this.index=parseInt(this.index,10),this.setup(),this.begin(),this.element.addEventListener?(this.browser.touch&&(this.element.addEventListener("touchstart",this,!1),this.element.addEventListener("touchmove",this,!1),this.element.addEventListener("touchend",this,!1)),this.browser.transitions&&(this.element.addEventListener("webkitTransitionEnd",this,!1),this.element.addEventListener("msTransitionEnd",this,!1),this.element.addEventListener("oTransitionEnd",this,!1),this.element.addEventListener("transitionend",this,!1)),window.addEventListener("resize",this,!1)):window.onresize=function(){c.setup()})},Swipe.prototype={setup:function(){if(this.slides=this.element.children,this.length=this.slides.length,this.cache=new Array(this.length),!(this.length<2)&&(this.width=this.container.getBoundingClientRect().width||this.container.offsetWidth,this.width)){var a=[[],[],[]];this.element.style.width=this.slides.length*this.width+"px";for(var b=this.length-1;b>-1;b--){var c=this.slides[b];c.style.width=this.width+"px",c.setAttribute("data-index",b),this.browser.transitions&&(c.style.left=b*-this.width+"px"),a[this.index>b?0:this.index<b?2:1].push(b)}this.browser.transitions&&(this._stack(a[0],-1),this._stack(a[1],0),this._stack(a[2],1)),this.container.style.visibility="visible"}},kill:function(){this.delay=0,clearTimeout(this.interval);for(var a=[],b=this.slides.length-1;b>=0;b--)this.slides[b].style.width="",a.push(b);this._stack(a,0);var c=this.element;c.className=c.className.replace("swipe-active",""),this.element.removeEventListener?(this.browser.touch&&(this.element.removeEventListener("touchstart",this,!1),this.element.removeEventListener("touchmove",this,!1),this.element.removeEventListener("touchend",this,!1)),this.browser.transitions&&(this.element.removeEventListener("webkitTransitionEnd",this,!1),this.element.removeEventListener("msTransitionEnd",this,!1),this.element.removeEventListener("oTransitionEnd",this,!1),this.element.removeEventListener("transitionend",this,!1)),window.removeEventListener("resize",this.resize,!1)):window.onresize=null},getPos:function(){return this.index},prev:function(a){this.delay=a||0,clearTimeout(this.interval),this.index?this.slide(this.index-1,this.speed):this.cont&&this.slide(this.length-1,this.speed)},next:function(a){this.delay=a||0,clearTimeout(this.interval),this.index<this.length-1?this.slide(this.index+1,this.speed):this.cont&&this.slide(0,this.speed)},begin:function(){var a=this;this.interval=this.delay?setTimeout(function(){a.next(a.delay)},this.delay):0},handleEvent:function(a){switch(a.type){case"touchstart":this.onTouchStart(a);break;case"touchmove":this.onTouchMove(a);break;case"touchend":this.onTouchEnd(a);break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"transitionend":this.onTransitionEnd(a);break;case"resize":this.setup()}a.stopPropagation()},onTouchStart:function(a){var b=this;b.start={pageX:a.touches[0].pageX,pageY:a.touches[0].pageY,time:Number(new Date)},b.isScrolling=void 0,b.deltaX=0},onTouchMove:function(a){var b=this;a.touches.length>1||a.scale&&1!==a.scale||(b.deltaX=a.touches[0].pageX-b.start.pageX,"undefined"==typeof b.isScrolling&&(b.isScrolling=!!(b.isScrolling||Math.abs(b.deltaX)<Math.abs(a.touches[0].pageY-b.start.pageY))),b.isScrolling?b.disableScroll&&a.preventDefault():(a.preventDefault(),b.delay=0,clearTimeout(b.interval),b.deltaX=b.deltaX/(!b.index&&b.deltaX>0||b.index==b.length-1&&b.deltaX<0?Math.abs(b.deltaX)/b.width+1:1),b._move([b.index-1,b.index,b.index+1],b.deltaX)))},onTouchEnd:function(){var b=this,c=Number(new Date)-b.start.time<250&&Math.abs(b.deltaX)>20||Math.abs(b.deltaX)>b.width/2,d=!b.index&&b.deltaX>0||b.index==b.length-1&&b.deltaX<0,e=b.deltaX<0;b.isScrolling||(c&&!d?(e?(b._stack([b.index-1],-1),b._slide([b.index,b.index+1],-b.width,b.speed),b.index+=1):(b._stack([b.index+1],1),b._slide([b.index-1,b.index],b.width,b.speed),b.index+=-1),b.callback(b.index,b.slides[b.index])):b._slide([b.index-1,b.index,b.index+1],0,b.speed))},onTransitionEnd:function(a){this._getElemIndex(a.target)==this.index&&(this.delay&&this.begin(),this.transitionEnd(this.index,this.slides[this.index]))},slide:function(a){var c=this.index;if(c!=a){if(this.browser.transitions){for(var d=Math.abs(c-a)-1,e=Math.abs(c-a)/(c-a),f=[],g=0;g<this.slides.length;g++){var h=this.slides[g];g>index&&1==e?h.style.zIndex=100-g:index>g&&-1==e?h.style.zIndex=100+g:g==index&&(h.style.zIndex=999)}for(;d--;)f.push((a>c?a:c)-d-1);this._stack(f,e),this._slide([c,a],this.width*e,this.speed)}else this._animate(c*-this.width,a*-this.width,this.speed);this.index=a,this.callback(this.index,this.slides[this.index])}},_slide:function(a,b,c){for(var d=this.slides,e=a.length+1;e--;)this._translate(d[a[e]],b+this.cache[a[e]],c?c:0),this.cache[a[e]]+=b},_stack:function(a,b){for(var c=this.slides,d=a.length,e=this.width*b;d--;)this._translate(c[a[d]],e,0),this.cache[a[d]]=e},_move:function(a,b){for(var c=this.slides,d=a.length;d--;)this._translate(c[a[d]],b+this.cache[a[d]],0)},_translate:function(a,b,c){if(a){var d=a.style;d.webkitTransitionDuration=d.MozTransitionDuration=d.msTransitionDuration=d.OTransitionDuration=d.transitionDuration=c+"ms",d.webkitTransform="translate("+b+"px,0)"+"translateZ(0)",d.msTransform=d.MozTransform=d.OTransform="translateX("+b+"px)"}},_animate:function(a,b,c){var d=this.element;if(!c)return d.style.left=b+"px",void 0;var e=this,f=new Date,g=setInterval(function(){var h=new Date-f;return h>c?(d.style.left=b+"px",e._getElemIndex(d)==e.index&&(e.delay&&e.begin(),e.transitionEnd(e.index,e.slides[e.index])),clearInterval(g),void 0):(d.style.left=(b-a)*(Math.floor(100*(h/c))/100)+a+"px",void 0)},4)},_getElemIndex:function(a){return parseInt(a.getAttribute("data-index"),10)}},(window.jQuery||window.Zepto)&&function(a){a.fn.Swipe=function(b){return this.each(function(){var c=a(this);c.data("Swipe",new Swipe(c[0],b))})}}(window.jQuery||window.Zepto);